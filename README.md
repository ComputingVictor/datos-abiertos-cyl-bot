# ğŸ›ï¸ Portal de Datos Abiertos - Bot de Telegram

**Tu asistente inteligente para explorar los datos abiertos de Castilla y LeÃ³n**

[![Telegram](https://img.shields.io/badge/Telegram-@cyl__asistente__bot-blue?logo=telegram)](https://t.me/cyl_asistente_bot)
[![Website](https://img.shields.io/badge/Website-Visitar-brightgreen?logo=github)](https://computingvictor.github.io/datos-abiertos-cyl-bot/)
[![License](https://img.shields.io/badge/License-MIT-yellow?logo=opensourceinitiative)](LICENSE)
[![Railway](https://img.shields.io/badge/Deploy-Railway-blueviolet?logo=railway)](https://railway.app)

## ğŸš€ **Â¡PruÃ©balo ahora!**

ğŸ‘‰ **[Abrir bot en Telegram](https://t.me/cyl_asistente_bot)** ğŸ‘ˆ

ğŸ’» **[Visitar pÃ¡gina web oficial](https://computingvictor.github.io/datos-abiertos-cyl-bot/)**

---

## ğŸŒŸ **Â¿QuÃ© es este bot?**

Un **asistente inteligente de Telegram** que te da acceso inmediato a **mÃ¡s de 400 datasets oficiales** de la Junta de Castilla y LeÃ³n. Sin registros, sin complicaciones, completamente **gratuito**.

### âœ¨ **Â¿Por quÃ© usar este bot?**

- ğŸ” **BÃºsqueda inteligente** con sinÃ³nimos (busca "clÃ­nica" y encuentra datasets de "salud")
- ğŸ“± **Acceso mÃ³vil 24/7** desde cualquier lugar
- ğŸ”” **Alertas automÃ¡ticas** cuando se actualicen los datos que te interesan
- ğŸ’¾ **Descargas directas** en Excel, CSV, JSON y mÃ¡s formatos
- â­ **Favoritos** para acceso rÃ¡pido a tus datasets mÃ¡s usados

---

## ğŸ“Š **Â¿QuÃ© datos puedes encontrar?**

### ğŸ¥ **Salud**
Hospitales, centros de salud, estadÃ­sticas sanitarias, recursos mÃ©dicos

### ğŸ“ **EducaciÃ³n**  
Centros educativos, programas formativos, becas, estadÃ­sticas acadÃ©micas

### ğŸ¨ **Turismo**
Alojamientos rurales, rutas turÃ­sticas, patrimonio cultural, puntos de interÃ©s

### ğŸŒ± **Medio Ambiente**
Calidad del aire, espacios naturales, energÃ­as renovables, gestiÃ³n de residuos

### ğŸ‘¥ **DemografÃ­a**
PoblaciÃ³n por municipios, censos, estadÃ­sticas de edad y gÃ©nero

### ğŸ’¼ **EconomÃ­a**
Empresas registradas, comercio, indicadores econÃ³micos, presupuestos pÃºblicos

### ğŸšŒ **Transporte**
LÃ­neas de autobÃºs, estaciones, infraestructuras de transporte

### ğŸ  **Vivienda**
Precios de vivienda, alquileres, promociones pÃºblicas

*...y muchas categorÃ­as mÃ¡s*

---

## ğŸ¯ **Casos de uso reales**

### ğŸ‘¨â€ğŸ“ **Estudiantes e Investigadores**
- **Proyectos de fin de grado**: Datos oficiales para TFG/TFM
- **AnÃ¡lisis estadÃ­sticos**: InformaciÃ³n demogrÃ¡fica y econÃ³mica verificada
- **Visualizaciones**: Archivos CSV y JSON listos para usar

### ğŸ¢ **Empresas y Startups**
- **AnÃ¡lisis de mercado**: Datos econÃ³micos para estudios de viabilidad
- **ExpansiÃ³n geogrÃ¡fica**: InformaciÃ³n detallada sobre municipios
- **Turismo rural**: Descubre oportunidades en el sector

### ğŸ‘¨â€ğŸ’¼ **AdministraciÃ³n PÃºblica**
- **Benchmarking**: Compara datos con otros municipios
- **PolÃ­ticas pÃºblicas**: Base de datos para toma de decisiones
- **Transparencia**: Acceso ciudadano a informaciÃ³n oficial

### ğŸ“° **Periodistas y Comunicadores**
- **Periodismo de datos**: InformaciÃ³n oficial para artÃ­culos
- **Fact-checking**: VerificaciÃ³n con fuentes oficiales
- **Tendencias regionales**: Seguimiento de indicadores clave

---

## ğŸ“± **CÃ³mo usar el bot**

### **Paso 1: Iniciar**
```
/start
```
Ve todas las categorÃ­as disponibles con un solo comando

### **Paso 2: Buscar**
```
/buscar salud
/buscar clÃ­nica
/buscar poblaciÃ³n LeÃ³n
```
BÃºsqueda inteligente con sinÃ³nimos y tÃ©rminos relacionados

### **Paso 3: Explorar**
- Toca cualquier categorÃ­a para ver sus datasets
- Los nÃºmeros indican cuÃ¡ntos datasets hay disponibles
- Usa emojis para identificar rÃ¡pidamente los temas

### **Paso 4: Descargar**
- MÃºltiples formatos: Excel, CSV, JSON, PDF
- Enlaces directos a fuentes oficiales
- Sin limitaciones ni registros

### **Paso 5: Gestionar** (Opcional)
```
/favoritos     # Tus datasets guardados
/mis_alertas   # Gestionar suscripciones
/recientes     # Ãšltimas actualizaciones
```

---

## ğŸ”” **Sistema de Alertas Inteligentes**

### **SuscrÃ­bete a categorÃ­as completas**
- Recibe notificaciones de nuevos datasets de salud, educaciÃ³n, etc.
- Control total: activa solo lo que te interesa

### **SuscrÃ­bete a datasets especÃ­ficos**  
- Te avisamos cuando se actualicen datos concretos
- Ejemplo: "Lista de hospitales de LeÃ³n actualizada"

### **GestiÃ³n simple**
- `+` para suscribirte directamente desde cualquier dataset
- `/mis_alertas` para ver y cancelar suscripciones
- Sin spam: solo recibes lo relevante

---

## ğŸ’¡ **Comandos principales**

| Comando | FunciÃ³n | Ejemplo |
|---------|---------|---------|
| `/start` | Ver todas las categorÃ­as | - |
| `/buscar` | Buscar por palabras clave | `/buscar hospital` |
| `/recientes` | Datasets actualizados recientemente | - |
| `/estadisticas` | Resumen general del portal | - |
| `/favoritos` | Tus datasets guardados | - |
| `/mis_alertas` | Gestionar suscripciones | - |
| `/help` | Ayuda completa | - |

---

## âœ… **Ventajas Ãºnicas**

### ğŸ¯ **Sin complicaciones**
- No necesitas registrarte
- Interfaz intuitiva con botones
- Respuestas instantÃ¡neas

### ğŸ“Š **Datos oficiales 100% verificados**
- Directo de la Junta de Castilla y LeÃ³n  
- ActualizaciÃ³n automÃ¡tica diaria
- Sin manipulaciÃ³n ni interpretaciÃ³n

### ğŸ”„ **Siempre actualizado**
- SincronizaciÃ³n automÃ¡tica cada 2 horas
- Alertas proactivas de cambios
- Nunca trabajas con datos obsoletos

### ğŸ”’ **Privacidad garantizada**
- Solo almacenamos tu ID para alertas
- No guardamos datos personales
- CÃ³digo abierto para mÃ¡xima transparencia

---

## ğŸŒ **PÃ¡gina Web Oficial**

**Â¡Visita nuestro moderno sitio web!**

ğŸ‘‰ **[https://computingvictor.github.io/datos-abiertos-cyl-bot/](https://computingvictor.github.io/datos-abiertos-cyl-bot/)**

**CaracterÃ­sticas:**
- âœ¨ DiseÃ±o moderno estilo Apple con animaciones fluidas
- ğŸ“± Completamente responsive (mÃ³vil y desktop) 
- ğŸ“Š EstadÃ­sticas en tiempo real del portal
- ğŸš€ Acceso directo al bot desde la web

---

# ğŸ› ï¸ **DocumentaciÃ³n TÃ©cnica**

*Esta secciÃ³n estÃ¡ dirigida a desarrolladores y usuarios tÃ©cnicos*

## ğŸš€ **Despliegue**

### **OpciÃ³n 1: Railway (Recomendado para producciÃ³n)**

1. **Fork del repositorio**
```bash
git clone https://github.com/computingvictor/datos-abiertos-cyl-bot
cd DATOS-ABIERTOS-CYL-BOT
```

2. **Desplegar en Railway**
- Conecta tu cuenta GitHub con [Railway](https://railway.app)
- Selecciona el repositorio forkeado
- Railway detecta automÃ¡ticamente el Dockerfile

3. **Variables de entorno necesarias**
```bash
TELEGRAM_BOT_TOKEN=tu_token_aqui
DATABASE_URL=postgresql://... # Railway lo genera automÃ¡ticamente
JCYL_API_BASE_URL=https://analisis.datosabiertos.jcyl.es
ALERTS_ENABLED=true
```

4. **Configurar webhook**
```bash
curl -X POST "https://api.telegram.org/bot[TOKEN]/setWebhook" \
-d "url=https://tu-proyecto.railway.app/webhook"
```

### **OpciÃ³n 2: Docker local**

```bash
# 1. Clonar repositorio
git clone https://github.com/computingvictor/datos-abiertos-cyl-bot
cd DATOS-ABIERTOS-CYL-BOT

# 2. Configurar variables
cp .env.example .env
# Edita .env con tu TELEGRAM_BOT_TOKEN

# 3. Ejecutar
docker-compose up -d

# 4. Ver logs
docker-compose logs -f
```

### **OpciÃ³n 3: EjecuciÃ³n directa**

```bash
# Prerrequisitos: Python 3.11+
pip install -r requirements.txt

# Configurar variables
export TELEGRAM_BOT_TOKEN="tu_token"
export DATABASE_URL="sqlite:///bot.db"

# Ejecutar
python main.py
```

## ğŸ”§ **ConfiguraciÃ³n avanzada**

### **Variables de entorno completas**

| Variable | DescripciÃ³n | Valor por defecto | Requerida |
|----------|-------------|-------------------|-----------|
| `TELEGRAM_BOT_TOKEN` | Token del bot de Telegram | - | âœ… |
| `TELEGRAM_WEBHOOK_URL` | URL base para webhook (production) | - | ğŸŸ¡ |
| `DATABASE_URL` | ConexiÃ³n a base de datos | `sqlite:///jcyl_bot.db` | âŒ |
| `JCYL_API_BASE_URL` | URL de la API de JCyL | `https://analisis.datosabiertos.jcyl.es` | âŒ |
| `ALERTS_ENABLED` | Activar sistema de alertas | `true` | âŒ |
| `ALERTS_CHECK_INTERVAL_HOURS` | Frecuencia de verificaciÃ³n | `2` | âŒ |
| `FASTAPI_DEBUG` | Modo debug de FastAPI | `false` | âŒ |
| `DATASETS_PER_PAGE` | Datasets por pÃ¡gina | `10` | âŒ |
| `THEMES_PER_PAGE` | CategorÃ­as por pÃ¡gina | `10` | âŒ |

### **Arquitectura del sistema**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Telegram      â”‚    â”‚   FastAPI        â”‚    â”‚   JCYL API      â”‚
â”‚   Bot API       â”‚â—„â”€â”€â–ºâ”‚   Application    â”‚â—„â”€â”€â–ºâ”‚   (External)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   PostgreSQL/    â”‚
                       â”‚   SQLite DB      â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **API REST interna**

El bot expone endpoints internos para monitoreo:

- `GET /health` - Estado del servicio
- `GET /debug/themes` - Test conexiÃ³n con API JCyL  
- `GET /debug/datasets` - Test listado de datasets
- `POST /webhook` - Endpoint para webhook de Telegram

### **Estructura de base de datos**

```sql
-- Usuarios del bot
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    telegram_id BIGINT UNIQUE NOT NULL,
    username VARCHAR(255),
    first_name VARCHAR(255),
    last_name VARCHAR(255),
    created_at TIMESTAMP DEFAULT NOW()
);

-- Suscripciones a alertas
CREATE TABLE subscriptions (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    subscription_type VARCHAR(50), -- 'theme', 'dataset', 'keyword'
    subscription_id VARCHAR(255),
    subscription_name TEXT,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW()
);

-- Favoritos de usuarios
CREATE TABLE bookmarks (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    dataset_id VARCHAR(255) NOT NULL,
    dataset_title TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);
```

### **PersonalizaciÃ³n**

#### **AÃ±adir nuevos sinÃ³nimos de bÃºsqueda**
Edita `src/api/client.py`, funciÃ³n de bÃºsqueda:

```python
synonym_map = {
    'clinica': ['salud', 'medicina', 'hospital'],
    'tu_termino': ['sinonimo1', 'sinonimo2'],
    # AÃ±ade mÃ¡s aquÃ­
}
```

#### **Modificar emojis de categorÃ­as**
Edita `src/bot/keyboards.py`:

```python
theme_emojis = {
    'salud': 'ğŸ¥',
    'tu_categoria': 'ğŸ†•',  # AÃ±ade tu emoji personalizado
}
```

#### **Configurar intervalos de alertas**
```bash
# Verificar cada hora
ALERTS_CHECK_INTERVAL_HOURS=1

# Verificar cada 6 horas (por defecto)  
ALERTS_CHECK_INTERVAL_HOURS=6
```

## ğŸ“Š **Monitoreo y logs**

### **Logs importantes**
- InicializaciÃ³n de servicios
- Errores de API de JCyL
- Webhook de Telegram
- Sistema de alertas

### **MÃ©tricas de Railway**
- CPU y memoria usage
- Respuesta HTTP
- Logs en tiempo real
- Uptime monitoring

### **Health checks**
```bash
# Verificar estado
curl https://tu-proyecto.railway.app/health

# Test conexiÃ³n JCyL
curl https://tu-proyecto.railway.app/debug/themes
```

## ğŸ”’ **Seguridad**

### **Buenas prÃ¡cticas implementadas**
- âœ… Variables de entorno para secrets
- âœ… ValidaciÃ³n de entrada de usuarios  
- âœ… Rate limiting implÃ­cito vÃ­a Telegram
- âœ… No logging de datos sensibles
- âœ… HTTPS obligatorio en producciÃ³n

### **Consideraciones de privacidad**
- Solo almacenamos ID de Telegram (nÃºmero)
- No guardamos mensajes ni historial
- Datos mÃ­nimos necesarios para alertas
- Base de datos local/privada

## ğŸ§ª **Testing y desarrollo**

### **Entorno de desarrollo**
```bash
# Bot separado para testing
TELEGRAM_BOT_TOKEN=token_de_desarrollo
DATABASE_URL=sqlite:///test_bot.db

# Modo debug activado
FASTAPI_DEBUG=true
```

### **Testing manual**
1. Crear bot de prueba con @BotFather
2. Usar token de desarrollo
3. Base de datos separada
4. No configurar webhook (usa polling)

---

## ğŸ“ **Soporte**

### **Para usuarios finales**
- ğŸ¤– Usa `/help` dentro del bot
- ğŸ’¬ Telegram: [@ComputingVictor](https://t.me/ComputingVictor)

### **Para desarrolladores**
- ğŸ› **Issues**: [GitHub Issues](https://github.com/computingvictor/datos-abiertos-cyl-bot/issues)
- ğŸ”§ **Pull Requests**: Contribuciones bienvenidas
- ğŸ“§ **Email tÃ©cnico**: [victor@ejemplo.com]

### **Para datos oficiales**
- ğŸ›ï¸ **Portal JCyL**: [datosabiertos.jcyl.es](https://datosabiertos.jcyl.es)
- ğŸ“§ **Soporte oficial**: soporte@jcyl.es

---

## ğŸ‘¨â€ğŸ’» **CrÃ©ditos y agradecimientos**

**Desarrollado por:** [VÃ­ctor Viloria VÃ¡zquez](https://github.com/ComputingVictor)

**TecnologÃ­as utilizadas:**
- ğŸ Python 3.11+ 
- ğŸš€ FastAPI + Uvicorn
- ğŸ¤– python-telegram-bot
- ğŸ—„ï¸ SQLAlchemy + PostgreSQL/SQLite
- ğŸ³ Docker + Docker Compose
- â˜ï¸ Railway (hosting)
- ğŸ“Š GitHub Pages (web)

**Agradecimientos especiales:**
- Junta de Castilla y LeÃ³n por el portal de datos abiertos
- Comunidad de Python por las librerÃ­as excepcionales
- Railway por el hosting gratuito y sencillo

---

## ğŸ“„ **Licencia**

Este proyecto estÃ¡ bajo la **Licencia MIT**. Puedes usar, modificar y distribuir libremente.

Ver [LICENSE](LICENSE) para mÃ¡s detalles.

---

<div align="center">

**ğŸ›ï¸ Portal de Datos Abiertos - Junta de Castilla y LeÃ³n**

*Haciendo la informaciÃ³n pÃºblica mÃ¡s accesible para todos*

**[ğŸš€ Usar el bot](https://t.me/cyl_asistente_bot)** â€¢ **[ğŸ’» Ver cÃ³digo](https://github.com/computingvictor/datos-abiertos-cyl-bot)** â€¢ **[ğŸŒ Sitio web](https://computingvictor.github.io/datos-abiertos-cyl-bot/)**

</div>