# 🏛️ Portal de Datos Abiertos - Bot de Telegram

**Tu asistente inteligente para explorar los datos abiertos de Castilla y León**

[![Telegram](https://img.shields.io/badge/Telegram-@cyl__asistente__bot-blue?logo=telegram)](https://t.me/cyl_asistente_bot)
[![Website](https://img.shields.io/badge/Website-Visitar-brightgreen?logo=github)](https://computingvictor.github.io/datos-abiertos-cyl-bot/)
[![License](https://img.shields.io/badge/License-MIT-yellow?logo=opensourceinitiative)](LICENSE)
[![Railway](https://img.shields.io/badge/Deploy-Railway-blueviolet?logo=railway)](https://railway.app)

## 🚀 **¡Pruébalo ahora!**

👉 **[Abrir bot en Telegram](https://t.me/cyl_asistente_bot)** 👈

💻 **[Visitar página web oficial](https://computingvictor.github.io/datos-abiertos-cyl-bot/)**

---

## 🌟 **¿Qué es este bot?**

Un **asistente inteligente de Telegram** que te da acceso inmediato a **más de 400 datasets oficiales** de la Junta de Castilla y León. Sin registros, sin complicaciones, completamente **gratuito**.

### ✨ **¿Por qué usar este bot?**

- 🔍 **Búsqueda inteligente** con sinónimos (busca "clínica" y encuentra datasets de "salud")
- 📱 **Acceso móvil 24/7** desde cualquier lugar
- 🔔 **Alertas automáticas** cuando se actualicen los datos que te interesan
- 💾 **Descargas directas** en Excel, CSV, JSON y más formatos
- ⭐ **Favoritos** para acceso rápido a tus datasets más usados

---

## 📊 **¿Qué datos puedes encontrar?**

### 🏥 **Salud**
Hospitales, centros de salud, estadísticas sanitarias, recursos médicos

### 🎓 **Educación**  
Centros educativos, programas formativos, becas, estadísticas académicas

### 🏨 **Turismo**
Alojamientos rurales, rutas turísticas, patrimonio cultural, puntos de interés

### 🌱 **Medio Ambiente**
Calidad del aire, espacios naturales, energías renovables, gestión de residuos

### 👥 **Demografía**
Población por municipios, censos, estadísticas de edad y género

### 💼 **Economía**
Empresas registradas, comercio, indicadores económicos, presupuestos públicos

### 🚌 **Transporte**
Líneas de autobús, estaciones, infraestructuras de transporte

### 🏠 **Vivienda**
Precios de vivienda, alquileres, promociones públicas

*...y muchas categorías más*

---

## 🎯 **Casos de uso reales**

### 👨‍🎓 **Estudiantes e Investigadores**
- **Proyectos de fin de grado**: Datos oficiales para TFG/TFM
- **Análisis estadísticos**: Información demográfica y económica verificada
- **Visualizaciones**: Archivos CSV y JSON listos para usar

### 🏢 **Empresas y Startups**
- **Análisis de mercado**: Datos económicos para estudios de viabilidad
- **Expansión geográfica**: Información detallada sobre municipios
- **Turismo rural**: Descubre oportunidades en el sector

### 👨‍💼 **Administración Pública**
- **Benchmarking**: Compara datos con otros municipios
- **Políticas públicas**: Base de datos para toma de decisiones
- **Transparencia**: Acceso ciudadano a información oficial

### 📰 **Periodistas y Comunicadores**
- **Periodismo de datos**: Información oficial para artículos
- **Fact-checking**: Verificación con fuentes oficiales
- **Tendencias regionales**: Seguimiento de indicadores clave

---

## 📱 **Cómo usar el bot**

### **Paso 1: Iniciar**
```
/start
```
Ve todas las categorías disponibles con un solo comando

### **Paso 2: Buscar**
```
/buscar salud
/buscar clínica
/buscar población León
```
Búsqueda inteligente con sinónimos y términos relacionados

### **Paso 3: Explorar**
- Toca cualquier categoría para ver sus datasets
- Los números indican cuántos datasets hay disponibles
- Usa emojis para identificar rápidamente los temas

### **Paso 4: Descargar**
- Múltiples formatos: Excel, CSV, JSON, PDF
- Enlaces directos a fuentes oficiales
- Sin limitaciones ni registros

### **Paso 5: Gestionar** (Opcional)
```
/favoritos     # Tus datasets guardados
/mis_alertas   # Gestionar suscripciones
/recientes     # Últimas actualizaciones
```

---

## 🔔 **Sistema de Alertas Inteligentes**

### **Suscríbete a categorías completas**
- Recibe notificaciones de nuevos datasets de salud, educación, etc.
- Control total: activa solo lo que te interesa

### **Suscríbete a datasets específicos**  
- Te avisamos cuando se actualicen datos concretos
- Ejemplo: "Lista de hospitales de León actualizada"

### **Gestión simple**
- `+` para suscribirte directamente desde cualquier dataset
- `/mis_alertas` para ver y cancelar suscripciones
- Sin spam: solo recibes lo relevante

---

## 💡 **Comandos principales**

| Comando | Función | Ejemplo |
|---------|---------|---------|
| `/start` | Ver todas las categorías | - |
| `/buscar` | Buscar por palabras clave | `/buscar hospital` |
| `/recientes` | Datasets actualizados recientemente | - |
| `/estadisticas` | Resumen general del portal | - |
| `/favoritos` | Tus datasets guardados | - |
| `/mis_alertas` | Gestionar suscripciones | - |
| `/help` | Ayuda completa | - |

---

## ✅ **Ventajas únicas**

### 🎯 **Sin complicaciones**
- No necesitas registrarte
- Interfaz intuitiva con botones
- Respuestas instantáneas

### 📊 **Datos oficiales 100% verificados**
- Directo de la Junta de Castilla y León  
- Actualización automática diaria
- Sin manipulación ni interpretación

### 🔄 **Siempre actualizado**
- Sincronización automática cada 2 horas
- Alertas proactivas de cambios
- Nunca trabajas con datos obsoletos

### 🔒 **Privacidad garantizada**
- Solo almacenamos tu ID para alertas
- No guardamos datos personales
- Código abierto para máxima transparencia

---

## 🌐 **Página Web Oficial**

**¡Visita nuestro moderno sitio web!**

👉 **[https://computingvictor.github.io/datos-abiertos-cyl-bot/](https://computingvictor.github.io/datos-abiertos-cyl-bot/)**

**Características:**
- ✨ Diseño moderno estilo Apple con animaciones fluidas
- 📱 Completamente responsive (móvil y desktop) 
- 📊 Estadísticas en tiempo real del portal
- 🚀 Acceso directo al bot desde la web

---

# 🛠️ **Documentación Técnica**

*Esta sección está dirigida a desarrolladores y usuarios técnicos*

## 🚀 **Despliegue**

### **Opción 1: Railway (Recomendado para producción)**

1. **Fork del repositorio**
```bash
git clone https://github.com/computingvictor/datos-abiertos-cyl-bot
cd DATOS-ABIERTOS-CYL-BOT
```

2. **Desplegar en Railway**
- Conecta tu cuenta GitHub con [Railway](https://railway.app)
- Selecciona el repositorio forkeado
- Railway detecta automáticamente el Dockerfile

3. **Variables de entorno necesarias**
```bash
TELEGRAM_BOT_TOKEN=tu_token_aqui
DATABASE_URL=postgresql://... # Railway lo genera automáticamente
JCYL_API_BASE_URL=https://analisis.datosabiertos.jcyl.es
ALERTS_ENABLED=true
```

4. **Configurar webhook**
```bash
curl -X POST "https://api.telegram.org/bot[TOKEN]/setWebhook" \
-d "url=https://tu-proyecto.railway.app/webhook"
```

### **Opción 2: Docker local**

```bash
# 1. Clonar repositorio
git clone https://github.com/computingvictor/datos-abiertos-cyl-bot
cd DATOS-ABIERTOS-CYL-BOT

# 2. Configurar variables
cp .env.example .env
# Edita .env con tu TELEGRAM_BOT_TOKEN

# 3. Ejecutar
docker-compose up -d

# 4. Ver logs
docker-compose logs -f
```

### **Opción 3: Ejecución directa**

```bash
# Prerrequisitos: Python 3.11+
pip install -r requirements.txt

# Configurar variables
export TELEGRAM_BOT_TOKEN="tu_token"
export DATABASE_URL="sqlite:///bot.db"

# Ejecutar
python main.py
```

## 🔧 **Configuración avanzada**

### **Variables de entorno completas**

| Variable | Descripción | Valor por defecto | Requerida |
|----------|-------------|-------------------|-----------|
| `TELEGRAM_BOT_TOKEN` | Token del bot de Telegram | - | ✅ |
| `TELEGRAM_WEBHOOK_URL` | URL base para webhook (production) | - | 🟡 |
| `DATABASE_URL` | Conexión a base de datos | `sqlite:///jcyl_bot.db` | ❌ |
| `JCYL_API_BASE_URL` | URL de la API de JCyL | `https://analisis.datosabiertos.jcyl.es` | ❌ |
| `ALERTS_ENABLED` | Activar sistema de alertas | `true` | ❌ |
| `ALERTS_CHECK_INTERVAL_HOURS` | Frecuencia de verificación | `2` | ❌ |
| `FASTAPI_DEBUG` | Modo debug de FastAPI | `false` | ❌ |
| `DATASETS_PER_PAGE` | Datasets por página | `10` | ❌ |
| `THEMES_PER_PAGE` | Categorías por página | `10` | ❌ |

### **Arquitectura del sistema**

```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   Telegram      │    │   FastAPI        │    │   JCYL API      │
│   Bot API       │◄──►│   Application    │◄──►│   (External)    │
└─────────────────┘    └──────────────────┘    └─────────────────┘
                               │
                               ▼
                       ┌──────────────────┐
                       │   PostgreSQL/    │
                       │   SQLite DB      │
                       └──────────────────┘
```

### **API REST interna**

El bot expone endpoints internos para monitoreo:

- `GET /health` - Estado del servicio
- `GET /debug/themes` - Test conexión con API JCyL  
- `GET /debug/datasets` - Test listado de datasets
- `POST /webhook` - Endpoint para webhook de Telegram

### **Estructura de base de datos**

```sql
-- Usuarios del bot
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    telegram_id BIGINT UNIQUE NOT NULL,
    username VARCHAR(255),
    first_name VARCHAR(255),
    last_name VARCHAR(255),
    created_at TIMESTAMP DEFAULT NOW()
);

-- Suscripciones a alertas
CREATE TABLE subscriptions (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    subscription_type VARCHAR(50), -- 'theme', 'dataset', 'keyword'
    subscription_id VARCHAR(255),
    subscription_name TEXT,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW()
);

-- Favoritos de usuarios
CREATE TABLE bookmarks (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    dataset_id VARCHAR(255) NOT NULL,
    dataset_title TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);
```

### **Personalización**

#### **Añadir nuevos sinónimos de búsqueda**
Edita `src/api/client.py`, función de búsqueda:

```python
synonym_map = {
    'clinica': ['salud', 'medicina', 'hospital'],
    'tu_termino': ['sinonimo1', 'sinonimo2'],
    # Añade más aquí
}
```

#### **Modificar emojis de categorías**
Edita `src/bot/keyboards.py`:

```python
theme_emojis = {
    'salud': '🏥',
    'tu_categoria': '🆕',  # Añade tu emoji personalizado
}
```

#### **Configurar intervalos de alertas**
```bash
# Verificar cada hora
ALERTS_CHECK_INTERVAL_HOURS=1

# Verificar cada 6 horas (por defecto)  
ALERTS_CHECK_INTERVAL_HOURS=6
```

## 📊 **Monitoreo y logs**

### **Logs importantes**
- Inicialización de servicios
- Errores de API de JCyL
- Webhook de Telegram
- Sistema de alertas

### **Métricas de Railway**
- CPU y memoria usage
- Respuesta HTTP
- Logs en tiempo real
- Uptime monitoring

### **Health checks**
```bash
# Verificar estado
curl https://tu-proyecto.railway.app/health

# Test conexión JCyL
curl https://tu-proyecto.railway.app/debug/themes
```

## 🔒 **Seguridad**

### **Buenas prácticas implementadas**
- ✅ Variables de entorno para secrets
- ✅ Validación de entrada de usuarios  
- ✅ Rate limiting implícito vía Telegram
- ✅ No logging de datos sensibles
- ✅ HTTPS obligatorio en producción

### **Consideraciones de privacidad**
- Solo almacenamos ID de Telegram (número)
- No guardamos mensajes ni historial
- Datos mínimos necesarios para alertas
- Base de datos local/privada

## 🧪 **Testing y desarrollo**

### **Entorno de desarrollo**
```bash
# Bot separado para testing
TELEGRAM_BOT_TOKEN=token_de_desarrollo
DATABASE_URL=sqlite:///test_bot.db

# Modo debug activado
FASTAPI_DEBUG=true
```

### **Testing manual**
1. Crear bot de prueba con @BotFather
2. Usar token de desarrollo
3. Base de datos separada
4. No configurar webhook (usa polling)

---

## 📞 **Soporte**

### **Para usuarios finales**
- 🤖 Usa `/help` dentro del bot
- 💬 Telegram: [@ComputingVictor](https://t.me/ComputingVictor)

### **Para desarrolladores**
- 🐛 **Issues**: [GitHub Issues](https://github.com/computingvictor/datos-abiertos-cyl-bot/issues)
- 🔧 **Pull Requests**: Contribuciones bienvenidas
- 📧 **Email técnico**: [victor@ejemplo.com]

### **Para datos oficiales**
- 🏛️ **Portal JCyL**: [datosabiertos.jcyl.es](https://datosabiertos.jcyl.es)
- 📧 **Soporte oficial**: soporte@jcyl.es

---

## 👨‍💻 **Créditos y agradecimientos**

**Desarrollado por:** [Víctor Viloria Vázquez](https://github.com/ComputingVictor)

**Tecnologías utilizadas:**
- 🐍 Python 3.11+ 
- 🚀 FastAPI + Uvicorn
- 🤖 python-telegram-bot
- 🗄️ SQLAlchemy + PostgreSQL/SQLite
- 🐳 Docker + Docker Compose
- ☁️ Railway (hosting)
- 📊 GitHub Pages (web)

**Agradecimientos especiales:**
- Junta de Castilla y León por el portal de datos abiertos
- Comunidad de Python por las librerías excepcionales
- Railway por el hosting gratuito y sencillo

---

## 📄 **Licencia**

Este proyecto está bajo la **Licencia MIT**. Puedes usar, modificar y distribuir libremente.

Ver [LICENSE](LICENSE) para más detalles.

---

<div align="center">

**🏛️ Portal de Datos Abiertos - Junta de Castilla y León**

*Haciendo la información pública más accesible para todos*

**[🚀 Usar el bot](https://t.me/cyl_asistente_bot)** • **[💻 Ver código](https://github.com/computingvictor/datos-abiertos-cyl-bot)** • **[🌐 Sitio web](https://computingvictor.github.io/datos-abiertos-cyl-bot/)**

</div>